<div id="gametitle">
    <h1 id="gametitle_label">Logs</h1>
</div>

<a href="#" class="romlink" onclick="loadLogs();" style="float: right;"><img src="/images/refresh.svg" alt="Refresh" title="Refresh" class="banner_button_image" /></a>
<table id="settings_events_table" style="width: 960px; max-width: 960px;" cellspacing="0">
    
</table>

<div style="width: 960px; text-align: center;">
    <button value="Load More" onclick="loadLogs(lastStartIndex, currentPage);">Load More</button>
</div>

<script type="text/javascript">
    var lastStartIndex = 0;
    var currentPage = 1;

    function loadLogs(StartIndex, PageNumber) {
        var apiQuery = '';

        if (StartIndex && PageNumber) {
            currentPage += 1;
            apiQuery = '?StartIndex=' + StartIndex + '&PageNumber=' + PageNumber;
        } else {
            currentPage = 1;
        }

        ajaxCall(
            '/api/v1.1/Logs' + apiQuery,
            'GET',
            function (result) {
                var newTable = document.getElementById('settings_events_table');
                if (currentPage == 1) {
                    newTable.innerHTML = '';
                
                    newTable.appendChild(
                        createTableRow(
                            true, 
                            [
                                //'Id',
                                ['Event Time', 'logs_table_cell_150px'],
                                ['Severity', 'logs_table_cell_150px'],
                                'Process',
                                'Message'
                            ],
                            '',
                            ''
                            )
                        );
                }

                for (var i = 0; i < result.length; i++) {
                    lastStartIndex = result[i].id;

                    var newRow = [
                        //result[i].id,
                        moment(result[i].eventTime).format("YYYY-MM-DD H:mm:ss"),
                        result[i].eventType,
                        result[i].process,
                        result[i].message
                    ];

                    newTable.appendChild(createTableRow(false, newRow, 'romrow logs_table_row_' + result[i].eventType, 'romcell logs_table_cell'));

                    if (result[i].exceptionValue) {
                        var exceptionString = "<h3>Exception</h3><pre class='logs_table_exception' style='width: 795px; word-wrap: break-word; overflow-wrap: break-word; overflow-y: scroll;'>" + syntaxHighlight(JSON.stringify(result[i].exceptionValue, null, 2)).replace(/\\n/g, "<br />    ") + "</pre>";
                        var exRow = document.createElement('tr');
                        var leadCell = document.createElement('td');
                        exRow.appendChild(leadCell);
                        var exCell = document.createElement('td');
                        exCell.colSpan = '3';
                        exCell.innerHTML = exceptionString;
                        exRow.appendChild(exCell);
                        newTable.appendChild(exRow);
                    }
                }
            }
        );
    }

    loadLogs();
</script>